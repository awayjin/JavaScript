# Node.js 简介

Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。

Node.js 使用了一个事件驱动、非阻塞式 I/O 的模型，使其轻量又高效。

## 1. 什么是技术预研
- 分析要做的需求，找出技术难点
- 针对每个技术难点进行攻克

## BFF 层
Backend for Frontend 服务于前端的后端
- 对用户侧提供 HTTP 服务
- 使用后端 RPC 服务

## node API
- requestAnimationFrame
- setImmediate
- process

## 2. Node.js 内置模块

OS 模块 - 操作系统相关

!['./v8-event-io.png']('./v8-event-io.png')

### 3. process 进程

process.argv 属性返回一个数组，其中包含当启动 Node.js 进程时传入的命令行参数
```javascript
let count = 0
process.stdin.on('data', e => {
  const playAction = e.toString().trim()
  const result = game(playAction)

  if (result === 1) {
    count++
    console.log(`你赢了 ${count} 次`)
  }

  if (count === 3) {
    console.log(`你赢了 ${count} 次, 我不玩了，退出！`)
    process.exit() // 退出
  }
})
```

### 4. events 事件触发器
EventEmitter
- 观察者模式 - addEventListener-removeEventListener
- 调用 vs 抛事件
• 关键在于“不知道被通知者存在”
• 以及“没有人听还能继续下去


## node.js 异步
- 事件循环
- 非阻塞 I/O

### 非阻塞 I/O
I/O Input/Output, 一个系统的输入和输出

理解非阻塞 I/O的要点：
- 确定一个进行 Input/Output 的系统
- 思考在 I/O 过程中，能不能进行其他 I/O

glob
```javascript
// 同步递归读取所有文件和文件夹
glob.sync(__dirname + '/**/*')

// 非阻塞I/O - 回调
glob(__dirname + '/**/*', function (err, files) { // 同步
 console.log(files)
})
```

## 5. Node.js 异步编程 - callback

回调函数格式规范
 - error-first callback
 - Node-style callback

第一个参数是 error, 后面的参数才是结果

异步流程控制， 异步的并发

npm: async
thunk


## 6. 事件循环
每个事件循环都是一个全新的调用栈。

宏观任务的队列就相当于事件循环。

函数调函数会形成调用栈
try-catch 机制
每个事件循环都是一个全新的调用栈。
setTimeout 是在另一个事件循环回调的，所以被抛到全局


## 7. Promise - 异步编程
> 概念: Promise 是一个对象，它代表了一个异步操作的最终完成或者失败。
当前事件循环得不到结果，但未来事件循环会得到结果。

是一个状态机：
- 3个状态：pending, resolved/filled, rejected
- 如果是 pending 转为 reject 需要 catch或then 错误处理。

执行 then 和 catch 会返回一个新 Promise，该 Promise 最终状态根据 then 和 catch 的回调函数的执行结果决定

- 如果回调函数最终是 throw，该 Promise 是 rejected 状态

- 如果回调函数最终是 return，该 Promise 是 resolved 状态

- 但如果回调函数最终 return 了一个 Promise ，该 Promise 会和回调函数 return 的Promise 状态保持一致
  
  
## 8. Node.js 异步编程 – async/await

async/await:
- async function 是 Promise 的语法糖封装
- 异步编程的终极方案 – 以同步的方式写异步
  - await 关键字可以“暂停”async function的执行
  
  - await 关键字可以以同步的写法获取 Promise 的执行结果
  
  - try-catch 可以获取 await 所得到的错误. 平常的异步任务 try-catch 是捕捉不到的.
  
- 一个穿越事件循环存在的 function

## 9. 什么是 HTTP 服务

超文本传输协议.Hypertext Transfer Protocol

什么是 HTTP 服务
- 应用层协议
- 五层网络协议。
  5. 应用层
  4. 传输层/运输层
  3. 网络层
  2. 数据链路层
  1. 物理层


一个网页请求，包含两次 HTTP 包交换：
- 浏览器向 HTTP 服务器发送请求 HTTP 包
- HTTP 服务器向浏览器返回 HTTP 包