<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Title</title>

</head>
<body>

<p>history API test</p>
<button id="btn1">pushSate 修改 url</button>
<button id="btn2">replaceSate 修改 url</button>
<section id="triggerPopSate">
  <h2>triggerPopSate</h2>
  <button id="back">history.back()</button>
  <button id="forward">history.forward()</button>
  <button id="goOne">history.go(1)</button>
  <button id="backOne">history.go(-1)</button>
  <a href="#/page1">#a page1</a>
  <a href="#/"># a /</a>
</section>

<script>

window.addEventListener('popstate', (event) => {
  console.log('--> event.state:', event.state)
  console.log('event:', event)
})

function q (id) {
  return document.getElementById(id)
}

// pushState
q('btn1').addEventListener('click', () => {
  const state = { 'page_id': 'page_id 11', 'user_id': 20 }
  const title = 'route history'
  const url = 'page1'
  history.pushState(state, title, url)
})

// replaceState
q('btn2').addEventListener('click', () => {
  const data = { 'page_id': 'page_id 11', 'user_id': 20 }
  const title = 'route history'
  const url = 'page1'
  history.replaceState(data, title, url)
})

q('back').addEventListener('click', () => {
  history.back()
})
q('forward').addEventListener('click', () => {
  history.forward()
})
q('goOne').addEventListener('click', () => {
  history.go(1)
})
q('backOne').addEventListener('click', () => {
  history.go(-1)
})

//创建全局事件
var _wr = function(type) {
  var orig = history[type];
  return function() {
    var rv = orig.apply(this, arguments);
    var e = new Event(type);
    e.arguments = arguments;
    window.dispatchEvent(e);
    return rv;
  };
};
//重写方法
history.pushState = _wr('pushState');
history.replaceState = _wr('replaceState');
//实现监听
window.addEventListener('replaceState', function(e) {
  console.log('THEY DID IT AGAIN! replaceState 111111');
});
window.addEventListener('pushState', function(e) {
  console.log('THEY DID IT AGAIN! pushState 2222222');
});


// 需要 server 端配合，可参考
// https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90
</script>

<pre>
location / {
  try_files $uri $uri/ /index.html;
}
</pre>
</body>
</html>