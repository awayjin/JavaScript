(function(){var a=Array.prototype;if(!a.indexOf){a.indexOf=function(d,c){if(c==null){c=0}else{if(c<0){c=Math.max(0,this.length+c)}}for(var b=c;b<this.length;b++){if(this[b]===d){return b}}return -1}}if(!a.lastIndexOf){a.lastIndexOf=function(d,c){if(c==null){c=this.length-1}else{if(c<0){c=Math.max(0,this.length+c)}}for(var b=c;b>=0;b--){if(this[b]===d){return b}}return -1}}if(!a.forEach){a.forEach=function(d,e){var b=this.length;for(var c=0;c<b;c++){d.call(e,this[c],c,this)}}}if(!a.filter){a.filter=function(e,g){var b=this.length;var d=[];for(var c=0;c<b;c++){if(e.call(g,this[c],c,this)){d.push(this[c])}}return d}}if(!a.map){a.map=function(e,g){var b=this.length;var d=[];for(var c=0;c<b;c++){d.push(e.call(g,this[c],c,this))}return d}}if(!a.some){a.some=function(d,e){var b=this.length;for(var c=0;c<b;c++){if(d.call(e,this[c],c,this)){return true}}return false}}if(!a.every){a.every=function(d,e){var b=this.length;for(var c=0;c<b;c++){if(!d.call(e,this[c],c,this)){return false}}return true}}a.contains=function(b){return this.indexOf(b)!=-1};a.copy=function(b){return this.concat()};a.insertAt=function(c,b){this.splice(b,0,c)};a.insertBefore=function(d,c){var b=this.indexOf(c);if(b==-1){this.push(d)}else{this.splice(b,0,d)}};a.removeAt=function(b){this.splice(b,1)};a.remove=function(c){var b=this.indexOf(c);if(b!=-1){this.splice(b,1)}}})();var SmartQueue=window.SmartQueue||{};SmartQueue.version="0.1.1";(function(){var l="function",d="number",i="string",a=0,j=1,g=2;var k=0;var h=SmartQueue.Queue=[[],[],[]];var b=function(m){return typeof m===d&&m>=a&&m<=g};var c=function(o,p){for(var n=0,m=o.length;n<m;n++){if(o[n].name===p){return n}}return -1};var f=function(p,n,o,m){if(typeof p!==l){throw new Error("Invalid argument type: fn.")}this.fn=p;this.level=b(n)?n:j;this.name=typeof o===i&&o?o:"t"+k++;this.dependencies=m instanceof Array?m:[]};var e=SmartQueue.Task=function(m){if(arguments.length>1){f.apply(this,arguments)}else{f.call(this,m.fn,m.level,m.name,m.dependencies)}this.context=m.context||window;this.data=m.data||{}};e.prototype={enabled:true,register:function(){var m=h[this.level];if(c(m,this.name)!==-1){throw new Error("Specified name exists: "+this.name)}m.push(this)},changeTo:function(m){if(!b(m)){throw new Error("Invalid argument: level")}m=parseInt(m,10);if(this.level===m){return}h[this.level].remove(this);this.level=m;this.register()},execute:function(){if(this.enabled){this.fn.call(this.context,this.data)}},toString:function(){var m=this.name;if(this.dependencies.length){m+=" depends on: ["+this.dependencies.join(", ")+"]"}return m}};SmartQueue.init=function(){h.forEach(function(m){m.length=0})};SmartQueue.fire=function(){var o=true,m=[],q;var n=function(t,u){if(u._visited>=1){u._visited++;return}u._visited=1;var w=[],v;u.dependencies.forEach(function(x){v=c(t,x);if(v!=-1){w.push(t[v])}});w.forEach(function(x){n(t,x)});if(u._visited===1){m[q].push(u)}},s=function(t){t.forEach(function(u){n(t,u)})},p=function(u){for(q=a;q<=g;q++){var t=h[q];m[q]=[];s(t);if(!u&&t.length>m[q].length){throw new Error("Cycle found in queue: "+t)}}},r=function(t){t.forEach(function(u){u.execute()});t.length=0};return function(u){if(!o){return}o=true;p(u);for(var t=g;t>=a;t--){r(m[t])}}}()})();